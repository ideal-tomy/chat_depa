# ボット一覧ページ パフォーマンス改善計画書

## 1. 背景と問題点

現在のボット一覧ページ (`/bots`) は、表示速度が著しく遅いという問題を抱えている。これは、ページ読み込み時にデータベースから**すべてのボット情報**を一括で取得し、クライアントサイドで処理していることが主な原因である。この実装は、ボット数が増加するにつれてスケールせず、ユーザー体験を大きく損なう。

## 2. 目的

- ボット一覧ページの初期表示速度を大幅に改善する。
- 必要なデータのみを段階的に読み込むことで、サーバーとクライアントの負荷を軽減する。
- 将来的なデータ増加に対応可能な、スケーラブルなアーキテクチャを構築する。

## 3. 改善計画：クライアントサイドでのデータ取得と無限スクロールの実装

Server Componentsで全件取得する現在の方式から、Client Componentsで必要なデータのみを非同期に取得する方式へ変更する。

### ステップ1: データ取得ロジックのコンポーネント分離

1.  **`BotList.tsx` の新規作成**
    -   場所: `src/components/bots/BotList.tsx`
    -   役割:
        -   Supabaseからボットデータをページ単位で取得するロジックを実装する (`"use client"`)
        -   取得したボットのリスト、ローディング状態、ページ番号などの状態を管理する。
        -   取得したデータを `BotCard` コンポーネントを使って一覧表示する。
        -   ユーザーがページ下部までスクロールしたことを検知し、次のページのデータを自動で読み込む「無限スクロール」機能を実装する。

### ステップ2: 既存コンポーネントの責務変更と統合

1.  **`app/bots/page.tsx` のリファクタリング**
    -   現在のデータ取得ロジック (`supabase.from('bots').select('*')`) をすべて削除する。
    -   ページの静的な骨格（タイトル、ヒーローセクション、フィルターバーなど）のみを描画するように責務を限定する。
    -   動的なボット一覧の表示部分は、新しく作成した `<BotList />` コンポーネントを呼び出す形に置き換える。

2.  **既存コンポーネントの統合**
    -   `CategorySection.tsx` や `CategoryCarousel.tsx` は、現在 `page.tsx` で静的に生成されたデータをもとに表示されている。`BotList.tsx` がフィルタリング機能を持つことを考えると、これらのコンポーネントも `BotList.tsx` 内で状態管理されるデータと連携させるか、あるいは `BotList` 自体がカテゴリ別の表示機能を持つように統合することを検討する。
    -   まずは無限スクロールによるパフォーマンス改善を優先し、その後にフィルタリング機能と既存コンポーネントの連携をリファクタリングする。

### ステップ3: UI/UXの改善

1.  **ローディング体験の向上**
    -   初期表示時、および無限スクロールによる追加データ読み込み時には、`loading.tsx` で定義されたスケルトンUIを表示し、ユーザーに処理中であることを明確に伝える。
    -   すべてのデータを読み込んだ後には、「これ以上データはありません」といったメッセージを表示する。

## 4. 期待される効果

- **初期表示の高速化**: 最初に表示するデータ量が最小限になるため、ページの体感速度が劇的に向上する。
- **スケーラビリティの確保**: ボットの総数が数千、数万に増えても、パフォーマンスへの影響を最小限に抑えられる。
- **サーバー負荷の軽減**: 一度のクエリで取得するデータ量が少なくなるため、データベースサーバーへの負荷が軽減される。
