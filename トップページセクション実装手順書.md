# トップページセクション実装手順書

## 概要
トップページに以下の3つのセクションを追加する：
1. **おすすめのBot** - 管理者指定の優先ボット
2. **人気のBot** - 利用頻度の高いボット  
3. **新着Bot** - 最近追加されたボット

## 現在の問題状況

### ✅ 実装済み
- [x] セクションのJSXコード
- [x] データ取得API (`/api/bots/optimized-order`)
- [x] カテゴリマッピング機能
- [x] 基本的なデータ処理ロジック

### ❌ 未実装・問題あり
- [ ] DynamicCarouselコンポーネントの修正
- [ ] セクション別ボット抽出ロジックの最適化
- [ ] 重複表示の解決
- [ ] データベースフラグの設定

## 実装タスクチェック表

### Phase 1: DynamicCarouselコンポーネントの修正
- [ ] **Task 1.1**: DynamicCarouselコンポーネントの調査
  - [ ] `src/components/ui/DynamicCarousel.tsx`の内容確認
  - [ ] `displayType`プロパティの動作確認
  - [ ] ボットデータの受け渡し方法の確認

- [ ] **Task 1.2**: DynamicCarouselの修正
  - [ ] `displayType`に応じたボットデータの自動取得機能を無効化
  - [ ] 外部から渡されたボットデータを表示するように修正
  - [ ] プロパティの型定義を更新

### Phase 2: セクション別ボット抽出ロジックの最適化
- [ ] **Task 2.1**: 重複表示の解決
  - [ ] おすすめ、人気、新着セクション間での重複を排除
  - [ ] 各セクションの表示条件を明確化
  - [ ] ボットの優先順位ロジックを実装

- [ ] **Task 2.2**: セクション別データ抽出ロジックの改善
  - [ ] おすすめボット: 管理者指定フラグまたは上位6件
  - [ ] 人気ボット: 利用頻度またはポイント上位6件
  - [ ] 新着ボット: 1週間以内作成のボット6件

### Phase 3: データベーススキーマの拡張
- [ ] **Task 3.1**: 必要なカラムの追加
  - [ ] `is_pickup` (boolean) - おすすめフラグ
  - [ ] `is_trending` (boolean) - 人気フラグ  
  - [ ] `is_new` (boolean) - 新着フラグ
  - [ ] `featured_priority` (integer) - おすすめ優先度
  - [ ] `usage_count` (integer) - 利用回数

- [ ] **Task 3.2**: データベースマイグレーション
  - [ ] Supabaseでカラム追加のSQL実行
  - [ ] 既存データへのフラグ設定
  - [ ] テストデータの投入

### Phase 4: APIエンドポイントの最適化
- [ ] **Task 4.1**: 最適化APIの改善
  - [ ] フラグベースの抽出ロジックを有効化
  - [ ] セクション別データ取得の最適化
  - [ ] キャッシュ機能の追加

- [ ] **Task 4.2**: セクション別APIの作成
  - [ ] `/api/bots/featured` - おすすめボット専用
  - [ ] `/api/bots/popular` - 人気ボット専用
  - [ ] `/api/bots/new` - 新着ボット専用

### Phase 5: フロントエンドの統合
- [ ] **Task 5.1**: トップページの修正
  - [ ] セクション別APIの呼び出し
  - [ ] ローディング状態の改善
  - [ ] エラーハンドリングの強化

- [ ] **Task 5.2**: コンポーネントの統合
  - [ ] 各セクションの表示確認
  - [ ] レスポンシブデザインの確認
  - [ ] パフォーマンスの最適化

### Phase 6: テスト・検証
- [ ] **Task 6.1**: 機能テスト
  - [ ] 各セクションの表示確認
  - [ ] データの正確性確認
  - [ ] 重複表示の確認

- [ ] **Task 6.2**: パフォーマンステスト
  - [ ] ページ読み込み速度の測定
  - [ ] API応答時間の確認
  - [ ] メモリ使用量の確認

## 実装の優先順位

### 高優先度（即座に実装）
1. **DynamicCarouselコンポーネントの修正** - 現在の表示問題を解決
2. **重複表示の解決** - ユーザー体験の向上
3. **基本的なセクション表示** - 最低限の機能実装

### 中優先度（段階的に実装）
1. **データベーススキーマの拡張** - 長期的な運用のため
2. **APIエンドポイントの最適化** - パフォーマンス向上
3. **高度な抽出ロジック** - より良いユーザー体験

### 低優先度（将来的な改善）
1. **キャッシュ機能** - パフォーマンス最適化
2. **A/Bテスト機能** - 効果測定
3. **パーソナライゼーション** - ユーザー別推薦

## 技術的な注意点

### コンポーネント設計
- 各セクションは独立したコンポーネントとして実装
- 共通のインターフェースを持つ
- 再利用可能な設計にする

### データフロー
- API → フロントエンド → コンポーネント → 表示
- エラーハンドリングを各層で実装
- ローディング状態を適切に管理

### パフォーマンス
- 不要な再レンダリングを避ける
- データの重複取得を防ぐ
- 適切なキャッシュ戦略を実装

## 完了条件

### 必須条件
- [ ] 3つのセクションが正常に表示される
- [ ] 各セクションに適切なボットが表示される
- [ ] 重複表示がない
- [ ] エラーが発生しない

### 推奨条件
- [ ] レスポンシブデザインが適用されている
- [ ] ローディング状態が適切に表示される
- [ ] パフォーマンスが良好である
- [ ] コードが保守しやすい構造になっている

## 参考資料
- 現在のAPI: `/api/bots/optimized-order`
- コンポーネント: `src/components/ui/DynamicCarousel.tsx`
- データベース: Supabase `bots`テーブル
